{% extends "base.html" %}
{% load materializecss %}

{% block title %}Settings{% endblock %}
{% block head %} 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.7/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/media/addons/materialize-colorpicker/js/materialize-colorpicker.js"></script>

<link rel="stylesheet" type="text/css" href="/media/addons/materialize-colorpicker/css/materialize-colorpicker.css" />

<script>
	var equ_id = null;
	var ev_id = null;
	var sp_id = null;
	var cf_id = null;

	var openModal = function(modelName, id){
		if(id != null){
			$("#settings_form_modal_content").load('/settings/forms/'+modelName+'/' + id + '/');
		} else {
			$("#settings_form_modal_content").load('/settings/forms/'+modelName);
		}
		$('#id_color').colorpicker();
		$('#settings_form_modal').openModal({
			ready: function() {
				$('#id_color').colorpicker();
			}
		});
	};

	$(document).ready(function(){
		$('.modal-trigger').click(function() {
			var modelName = this.id.split('.')[3];
			openModal(modelName, null);
		});

		$( ".datatable").dataTable({
 			"bJQueryUI": true,
			"bFilter": false,
			"bInfo": false,
			"bPaginate": false,
			"oLanguage": {
				"sUrl":   "/media/lang/dataTables.de_DE.txt"
			}
		});
		$( ".datatable_equipment").dataTable({
			"aoColumnDefs": [
				{
					"mRender": function ( data, type, full ) {
						if(type=="display"){
							return secondsToTime(data, true, true);
						} else {
							return data;
						}
					},
					"aTargets": [2]
				},
				{
					"mRender": function ( data, type, full ) {
						if(type=="display"){
							if (data != ""){
								return parseFloat(data).toFixed(2).replace( /\./,"," ) + " km/h";
							} else {
								return "-";
							}
						} else {
							return data;
						}
					},
					"aTargets": [3]
				},
				{
					"mRender": function ( data, type, full ) {
						if(type=="display"){
							if (data != ""){
								return parseFloat(data).toFixed(2).replace( /\./,"," ) + " km";
							} else {
								return "-";
							}
						} else {
							return data;
						}
					},
					"aTargets": [1]
				}
			],
 			"bJQueryUI": true,
			"bFilter": false,
			"bInfo": false,
			"bPaginate": false,
			"oLanguage": {
				"sUrl":   "/media/lang/dataTables.de_DE.txt"
			}
		});
	});

	var get_data = function(url, onDataReceived) {
		$.ajax({
		// have to use synchronous here, else the function
		// will return before the data is fetched
		async:false,
		url: url,
		dataType:"json",
		success: onDataReceived
		});
	};
</script>
{% endblock %}

{% block content %}
	<div class="row">
		<div class="col s12">
			<ul class="tabs">
				<li class="tab col s3"><a class="active" href="#tabs-equipment">Equipment</a></li>
				<li class="tab col s3"><a href="#tabs-events">Events</a></li>
				<li class="tab col s3"><a href="#tabs-templates">Vorlagen</a></li>
				<li class="tab col s3"><a href="#tabs-sports">Sportarten</a></li>
				<li class="tab col s3"><a href="#tabs-calformula">Kalorienformeln</a></li>
			</ul>
		</div>

		<div id="tabs-equipment" class="col s12 material-table">
			{% if equipments %}
				<table id="equipment_table" class="datatable_equipment ui compact selectable striped celled table raised segment">
					<thead>
					<tr><th>Name</th><th>Distanz</th><th>Zeit</th><th>Geschwindigkeit</th><th></th></tr>
					</thead>
					<tbody>
					{% for equ in equipments %}
						<tr>
							<td>
								{{equ.name}}&nbsp;&nbsp;
							</td>
							<td>{{equ.distance}}</td>
							<td>{{equ.time}}</td>
							<td>{{equ.speed}}</td>
							<td>
								<i class="material-icons" onclick="openModal('equipment', {{equ.id}})">mode_edit</i>
							</td>
						</tr>
					{%endfor %}
					</tbody>
				</table>
			{% else %}
				<p>No equipments are available</p>
			{%endif%}
			<a id="modal.trainingslog.settings.equipment.add" class="waves-effect waves-light btn modal-trigger"><i class="material-icons left">add</i></a>

			{% if equipments_archived %}
				<h2>Archiv</h2>
				<table id="equipment_archived_table" class="datatable_equipment ui compact selectable striped celled table raised segment">
					<thead>
					<tr><th>Name</th><th>Distanz</th><th>Zeit</th><th>Geschwindigkeit</th><th></th></tr>
					</thead>
					<tbody>
					{% for equ in equipments_archived %}
						<tr>
							<td>
								{{equ.name}}&nbsp;&nbsp;
							</td>
							<td>{{equ.distance}}</td>
							<td>{{equ.time}}</td>
							<td>{{equ.speed}}</td>
							<td>
								<i class="material-icons" onclick="openModal('equipment', {{equ.id}})">mode_edit</i>
							</td>
						</tr>
					{%endfor %}
					</tbody>
				</table>
			{%endif%}
		</div>

		<div id="tabs-events" class="col s12 material-table">
			{% if events %}
				<table id="event_table" class="datatable ui compact selectable striped celled table raised segment">
					<thead>
					<tr>
						<th>Name</th><th></th>
					</tr>
					</thead>
					<tbody>
					{% for event in events %}
						<tr>
							<td>
								{{event.name}}
							</td>
							<td>
								<i class="material-icons" onclick="openModal('event', {{event.id}})">mode_edit</i>
							</td>
						</tr>
					{%endfor %}
					</tbody>

				</table>
			{% else %}
				<p>No events are available</p>
			{%endif%}
			<a id="modal.trainingslog.settings.event.add" class="waves-effect waves-light btn modal-trigger"><i class="material-icons left">add</i></a>
		</div>

		<div id="tabs-templates" class="col s12 material-table">
			{% if activitytemplates %}
				<table id="activitytemplates_table" class="datatable ui compact selectable striped celled table raised segment">
					<thead>
					<tr>
						<th>Name</th><th></th>
					</tr>
					</thead>
					<tbody>
					{% for acttmp in activitytemplates %}
						<tr>
							<td>
								{{acttmp.name}}
							</td>
							<td>
								<i class="material-icons" onclick="showActivityTemplateDialog({{acttmp.id}}, onlytemplate = true)">mode_edit</i>
							</td>
						</tr>
					{%endfor %}
					</tbody>

				</table>
			{% else %}
				<p>Keine Vorlagen vorhanden</p>
			{%endif%}
			<input type="submit" id="acttmp_add" value="Neue Vorlage...">
		</div>

		<div id="tabs-sports" class="col s12 material-table">
			{% if sports %}
				<table id="sport_table" class="datatable ui compact selectable striped celled table raised segment">
					<thead>
					<tr>
						<th>Name</th>
						<th>Kalorienberechnung</th>
						<th>Farbe</th>
						<th></th>
					</tr>
					</thead>
					<tbody>
					{% for sport in sports %}
						<tr>
							<td>
								{{sport.name}}
							</td>
							<td>
								{% if sport.calorie_formula %}
									{{sport.calorie_formula}}
								{% else %}
									-
								{% endif %}
							</td>
							<td>
								<div class="colordisplay">
									<div style="background-color: {{sport.color}}"></div>
								</div>
							</td>
							<td>
								<i class="material-icons" onclick="openModal('sport', {{sport.id}})">mode_edit</i>
							</td>
						</tr>
					{%endfor %}

					</tbody>
				</table>
			{% else %}
				<p>Keine Sportarten festgelegt</p>
			{% endif %}
			<a id="modal.trainingslog.settings.sport.add" class="waves-effect waves-light btn modal-trigger"><i class="material-icons left">add</i></a>
		</div>

		<div id="tabs-calformula" class="col s12 material-table">
			{% if calformulas %}
				<table id="calories_table" class="datatable ui compact selectable striped celled table raised segment">
					<thead>
					<tr>
						<th>Name</th>
						<th>Formel</th>
						<th></th>
					</tr>
					</thead>
					<tbody>
					{% for calformula in calformulas %}
						<tr>
							<td>
								{{calformula.name}}
							</td>
							<td>
								kcal =
								{% if calformula.weight_dist_factor != 0 %}
									Distanz x Gewicht x {{calformula.weight_dist_factor}}
									{% if calformula.weight_time_factor != 0 %} + {% endif %}
								{% endif %}
								{% if calformula.weight_time_factor != 0 %}
									Zeit x Gewicht x {{calformula.weight_time_factor}}
								{% endif %}
							</td>
							<td>
							</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			{% endif %}
		</div>
	</div>
	<div id="settings_form_modal" class="modal">
		<div id="settings_form_modal_content" class="modal-content">
		</div>
	</div>

{% include "activities/includes/materialize_table_js.html" %}
{% endblock %}
